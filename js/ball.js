const ballSvgs = [
  new Path2D("M16.0921 29.9587C17.3702 28.0944 18.4476 26.032 20.3591 24.7204C22.1737 22.9007 24.0303 19.7918 25.2146 17.4164C26.9925 13.8505 30.359 11.9799 34.3372 10.9238C37.8868 9.98159 41.1346 7.67588 44.8576 7.45626C51.2541 7.07893 57.2007 4.35971 63.4339 3.17711C81.5973 -0.268991 100.578 3.81204 114.822 15.9408C117.352 18.0952 119.116 21.2563 120.928 23.9826C122.063 25.6889 123.987 27.0545 124.938 28.8151C127.556 33.6633 128.671 39.6675 130.124 44.9357C132.417 53.2466 131.964 61.6214 131.964 70.168C131.964 75.9467 132.015 81.3169 130.272 86.8788C128.461 92.6575 127.034 98.1755 122.326 102.262C118.954 105.188 115.407 108.426 112.431 111.742C108.083 116.587 104.046 120.312 97.6804 122.182C90.4925 124.293 83.2916 126.002 75.9039 127.309C64.4123 129.343 52.7161 129.787 41.2527 127.272C29.2612 124.642 20.3386 118.287 12.6343 109.049C10.5367 106.534 7.27315 104.245 6.19699 101.007C4.82885 96.8913 3.74869 92.5606 2.84959 88.3175C0.913057 79.1785 2.79963 69.4609 3.47493 60.3185C4.17688 50.8152 6.8526 42.8404 11.825 34.6805C12.9425 32.8467 14.8697 31.7417 16.0921 29.9587Z"),
  new Path2D("M42.4383 6.96674C45.4742 4.73632 47 4.5 48.5 4C50.5 3.5 54.486 2.8934 55.7343 2.73621C60.3887 2.1501 64.7702 1.52749 69.4891 1.52749C80.3877 1.52749 93.219 3.25437 102.83 8.62314C107.601 11.2883 112.645 13.1598 116.708 16.9499C119.85 19.8813 123.039 22.9197 125.583 26.3847C128.189 29.9346 129.474 33.6333 131.481 37.4982C133.457 41.3031 135.584 44.7981 136.864 48.9587C140.711 61.4596 141.776 74.6526 138.241 87.2797L138.172 87.5245C137.325 90.5524 136.339 94.0808 134.413 96.569C132.341 99.2474 130.198 101.857 128.123 104.56C126 107.327 123.452 109.718 121.274 112.461C118.777 115.606 116.043 118.426 113.014 121.068C109.824 123.851 105.782 125.259 101.901 126.843C97.7902 128.521 93.1577 129.852 88.7951 130.659C84.0993 131.529 79.3949 132.238 74.6709 132.92C69.6512 133.645 64.5701 134.787 59.4836 133.983C55.0397 133.282 50.6237 132.553 46.389 130.973C42.5546 129.542 38.7592 126.456 35.5217 123.989C26.9463 117.455 20.2485 109.69 13.899 101.09C12.0847 98.6333 10.0137 96.6666 8.66121 93.8829C7.42301 91.3344 6.11833 88.7301 5.19173 86.0486C3.48406 81.1067 1.62069 76.5482 2.41614 71.197C3.20484 65.8912 4.98836 60.763 6.57952 55.6514C7.80492 51.7148 8.69226 47.7304 10.4743 43.9895C12.1281 40.5178 14.1683 37.1803 16.0143 33.8049C17.8088 30.5235 20.6055 28.1413 22.7966 25.1536C25.0128 22.1314 27.3078 19.4369 30.0153 16.8268C33.8297 13.1497 38.1867 10.0904 42.4383 6.96674Z"),
]

// Ball factory
const BallFactory = (ballData) => {
  return {
    pos: new Vector(
      $("#canvas").width() / 2,
      $("#canvas").height() / 2
    ),
    currentSize: ballData.size,
    currentSvg: 0,
    currentTick: Math.floor(Math.random() * 600),
    ...ballData,
  }
}

// State mutation functions
const transformBall = (ball, newPos) => {
  ball.pos = newPos;
}

const collideBall = (b1, b2) => {
  if (b1.name === b2.name) {
    return;
  }

  const distanceApart = b1.pos.distance(b2.pos);
  if (b1.currentSize + b2.currentSize > distanceApart) {
    awayVector = b1.pos
      .difference(b2.pos);

      console.log(`{x: ${awayVector.x}, y: ${awayVector.y}}`)
    b1.pos = b1.pos.add(awayVector);
    console.log(`{x: ${b1.pos.x}, y: ${b1.pos.y}}`)
  }
}

const updateBall = (ball) => {
  ball.currentSize += (ball.size - ball.currentSize) / 25;
  ball.currentTick++;
  if (ball.currentTick % 30 === 0) {
    ball.currentSvg = (ball.currentSvg + 1) % ballSvgs.length
  }
}

const renderBall = (ball) => {
  const matrix = new DOMMatrix()
    .translate(
      tx=ball.pos.x,
      ty=ball.pos.y
    ).scale(
      scaleX=ball.currentSize,
      scaleY=ball.currentSize,
      originX=65,
      orignY=65
    )

  const path = new Path2D();
  path.addPath(
    ballSvgs[ball.currentSvg],
    matrix
  );

  ctx.beginPath();
  ctx.arc(ball.pos.x, ball.pos.y, ball.currentSize * 30, 0, 2 * Math.PI, false);
  ctx.fillStyle = ball.color;
  ctx.fill();
};